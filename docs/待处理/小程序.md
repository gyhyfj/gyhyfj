# 小程序

在小程序之前，是通过将 H5 放进公众号作为流量转换的入口，
但功能和性能受限，尽管可以通过 JS-SDK 可以拓展功能

后来搞小程序以实现：
快速加载
更强大的能力
原生的体验
易用且安全的微信数据开放
跨平台高效开发

原生小程序架构：

浏览器是一个单线程架构，主要原因是 js 允许访问操作 DOM，因此 js 线程和渲染线程只能互斥运行

小程序通过禁止 js 操作 DOM 来实现了一套双线程架构，分渲染层和逻辑层
可以：
提高性能，解耦代码逻辑

## 渲染层

渲染层可以有多个
采用 Exparser 组件模型参考了 shadow DOM 并进行了一些修改

wxml 代码会被先编译为虚拟 DOM，最后编译成 JS 文件，插入渲染层的 script 标签中
wxss 代码会对 rpx 进行处理，最后编译成 JS 文件，通过 eval 方式注入渲染层代码中

## 逻辑层

逻辑层只有一个
渲染层和逻辑层之间通过微信客户端进行桥接通信

在小程序执行的过程中，微信客户端分别向渲染层和逻辑层注入 WeixinJSBridge，采用事件系统进行通信
