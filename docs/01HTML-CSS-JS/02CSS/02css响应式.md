# CSS 响应式布局

响应式布局本身只是一个概念，它希望只用一份代码，适配所有大小的屏幕，
也就是无需根据手机、pc 网页写两份代码，
当然响应式布局也不仅适用于跨终端的显示上，毕竟单纯的 pc 网页或手机网页，也会存在不同的浏览器窗口大小、或屏幕大小的问题。
刚写网页的时候会以为项目中后期集中改就好了，但是往往到项目后期才发现，这些网页布局根本就写错了，或者瞎写的，还不如重写一遍。

## 正确的布局认知

首先，我们要有正确的布局认知。
错误的布局认知是，一下子看到了网页的所有元素，这样的话，由于需要顾及的细节太多，反而会导致无法很好地实现响应式布局。
就好像把大象塞进冰箱一共需要几步的问题一样，如果一开始就顾及所有细节，则不会得出只需要三步的答案。
而正确的布局认知应该是有层次的。

我们推荐把网页布局分为两层：整体层和模块层。
整体层是忽略网页细节，把一个网页分为几个合理的区域；而模块层是各个区域的具体细节。

### 整体层布局

整体层的布局是考虑页面各区块的布局，
很多布局工具，比如 bootstrap 的栅格布局，会按照浏览器横向分辨率，将网页划分为多种类型，
但是一般情况下，我们只需要关注 768px 分水岭就可以了，因为 768px 以下是手机，768px 以上是平板、pc 等。
如果不适用布局工具，可以写成这样子，根据屏幕宽度自动替换 css 文件

```html
<link href="styleA.css" media="screen and (max-width:768px)" />
<link href="styleB.css" media="screen and (min-width:768px)" />
```

如果使用 bootstrap 等布局工具，根据需要在相应标签上添加相应类名，来自动调整样式
对于整体布局，更推荐使用栅格系统等布局工具，但是这种布局工具也有局限，就是他们一般只会横向把屏幕分为固定份数，让开发者选择每个区块占几份。开发者只需要选择与 ui 设计相近的比例即可。

以上都只关心区块的宽度，那区块的高度呢？其实在响应式布局中，一般默认高度是作为宽度变化的补偿。
也就是说，某些网页内容，在较大的屏幕上，可能只需要一行就显示全了，但是在较小的屏幕上可能需要多行。也就是在较小的屏幕下高度需要增加。
所以一般情况下，高度是不用特别关心的。
但是诸如导航栏需要与屏幕等高，列表区域铺满页面等场景下，则需要考虑区域的高度。
可能会用到 calc 设置区域的高度，形如`height: calc(100% - 50px);`

### 模块层布局

模块层布局是比较精细的布局，但是相对整体层布局，模块层布局一般不受屏幕大小的影响，所以不太推荐布局工具，
而是推荐直接固定一部分元素的尺寸，其他元素使用 calc 相对这个固定尺寸的部分做填充。
当然，一些列表形式的元素，还是推荐使用栅格等布局工具做初步布局，但细节元素还是推荐上述的方式布局

另外一些特定模块细节在不同尺寸屏幕上需要做区分，
例如侧边导航栏在 pc 中需要固定显示，在手机端需要做成上方导航条的下拉菜单，除非区域特别小，其他情况推荐写两份代码，通过 css 的@media 或布局工具控制其显示隐藏。

## @media 媒体查询

```css
/* 语法 */
@media not|only mediatype and (mediafeature and|or|not mediafeature) {
  CSS-Code;
}

/* 示例 */
@media screen and (min-width: 400px) and (orientation: landscape) {
    body {
        color: blue;
    }
}
```

mediatype 分为 all、print、screen、speech
mediafeature 分为 min-width、max-width、width（正好是某个宽度）、orientation（portrait 竖放、landscape 横放）、hover（取值 hover 表示设备可以实现悬浮，有鼠标等指点设备）

此外还有：查询终端系统所处的亮/暗模式：

```css
@media (prefers-color-scheme: dark) {
  /* 终端系统为暗色模式时定义的样式 */
}
```

如果通过 js 来查询主题色：

```ts
const isDarkMode = [true, 'true'].includes(
  localStorage.getItem('zmo-editor-theme-color') ??
    (window.matchMedia &&
      window.matchMedia('(prefers-color-scheme: dark)').matches)
)
```

## 常见的 css 布局单位

### px

一个像素表示终端屏幕能显示的最小区域，分为逻辑像素和物理像素

### %

百分比，是相对于父元素的比例
如果是字体，且祖先元素都没设置字体尺寸，则相对于浏览器默认字体尺寸（16px）的比例

### em 和 rem

em 是相对长度单位，相对于当前对象的文本的字体尺寸，如果当前对象的字体尺寸未被设置，就一层层往上找。如果都找不到，就相对于浏览器的默认字体尺寸（16px）

rem 是相对长度，相对于 html 的根元素
如果设置`html{ font-size: 62.5% 或 10px }`，则 1rem=10px

可以通过媒体查询设置不同视口宽度下，html 元素的 font-size 属性值，以实现使用 rem 单位的字体的自适应

目前 rem 布局方案中，通常将网页等分成 10 份， HTML 标签的字号为视口宽度的 1/10

### vw 和 vh

1vw = 1/100 视口宽度
1vh = 1/100 视口高度

不允许 vw vh 混用

此外还有两个单位：
vmin：vw 和 vh 中的较小值
vmax：vw 和 vh 中的较大值

## 根据设计稿进行移动端适配

1. 根据不同的像素密度，使用 css 媒体查询，加载不同精度的图片
2. 根据设计稿转把尺寸转换为相对单位，以适应不同屏幕大小
