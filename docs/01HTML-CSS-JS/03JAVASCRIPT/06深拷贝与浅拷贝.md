# 深拷贝与浅拷贝

深拷贝 copy 数据，浅拷贝 copy 地址
引用数据类型有深浅拷贝之分

## 浅拷贝的方式

### obj2 = obj1

```js
let obj1 = {
  name: 'zs',
  age: 10,
}

obj2 = obj1
console.log(obj2) // { name: 'zs', age: 10 }
console.log(obj2 === obj1) // true

/* 修改obj2，obj1会一起变 */
obj2.age += 1
console.log(obj2) // { name: 'zs', age: 11 }
console.log(obj1) // { name: 'zs', age: 11 }
console.log(obj2 === obj1) // true
```

JS 中**字符串**在传值过程中会以引用类型的方式传递，但仍是基本数据类型（值类型），**不会通过修改 str2 影响到 str1**

```js
let obj1 = 'zs'

obj2 = obj1
console.log(obj2) // zs
console.log(obj2 === obj1) // true

/* 修改obj2，obj1不会变 */
obj2 = 'ls'
console.log(obj2) // 'ls'
console.log(obj1) // 'zs
console.log(obj2 === obj1) // false
```

### Object.assign()

Object.assign() 方法将所有可枚举和自有属性从一个或多个源对象复制到目标对象，返回修改后的对象。并不创建新对象，所以往往不使用返回值
第一个参数不可以是 undefined，第二个参数可以是 undefined
相比`let obj = {...obj1，obj2}`，则是创建新的对象，且支持拓展 undefined （只要避开 TS 报错）

```js
const target = { a: 1, b: 2 }
const source = { b: 4, c: 5 }

const re = Object.assign(target, source)
console.log(target) // 相同的属性会被覆盖
console.log(re)
console.log(target === re) // true 返回的就是修改后的对象
```

## 深拷贝

也就是创建了一个新的内存区域，里面放上同样的内容
注意： `obj2 = {...obj1}`，{...obj1}会返回一个新的内存中的区域，本质上仍是`obj2=新对象`

```js
let obj1 = {
  name: 'zs',
  age: 10,
  parent: {
    pa: 'zs',
    ma: 'ls',
  },
}

let obj2 = {}
for (let key in obj1) {
  obj2[key] = obj1[key] // 不能用obj.key, 因为会把单词key当做确定的属性名
}

console.log(obj2) // 与obj1相同
console.log(obj2 == obj1) // false
console.log(obj2 === obj1) // false
```

```js
obj2 = { ...obj1 }
arr2 = [...arr1]
```

## 实现深拷贝的方法

JSON.stringify()
函数库 lodash 的`_.cloneDeep` 方法
手写实现深拷贝函数

```js
function deepCopy(obj) {
  if (!obj || typeof obj !== 'object') return
  let newObj = Array.isArray(obj) ? [] : {}
  for (let key in obj) {
    if (obj.hasOwnProperty(key)) {
      newObj[key] = typeof obj[key] === 'object' ? deepCopy(obj[key]) : obj[key]
    }
  }
  return newObj
}
```

## 函数接受引用类型入参

如果函数接受了一个引用类型变量的入参，并直接把闭包中的某个值等于看这个入参，而不是对这个入参做深拷贝，那么闭包中的这个值就会改变指向而指向这个入参，闭包中的值变化了，入参也会同样跟着变化
所以如果接收了某个对象，然后需要把这个对象的值赋值给闭包中的某个变量，一定要做深拷贝，而不是直接用`=`运算
