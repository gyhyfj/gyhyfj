三到五年前 流行的 后来基本看不到

实际上在大厂里的应用是比较多的

微前端解决方案

应用场景

1. 组合不同前端技术栈构成页面
2. 页面性能不敏感的场景
3. 管理后台类场景

核心原理

流行框架

业务落地

iframe 的问题

路由同步
性能 iframe 是独立的进程,内存占用很大

只要能通信 postMsg 大多数问题就总能解决

但开发体验和组织体验都是非常差的

最早的方案是 single spa
做页面层的聚合

阿里大量地一个页面好几个块组成, 但这种做法其实非常极端, 没必要这么搞

C 端用微前端框架几乎是没有的, 基本都是管理后台, 完全不好优化, 加载时长完全不可控
但 b 站 好像用的乾坤

国内的管理的后台可以做得非常大, 左边的菜单就能做五六十个
相反, 国外的管理后台很少做到这么大的, 不会在一个管理后台把所有的事情完完全全地做完, 一般情况是这样的

几乎是无限大, 会一直在加功能进去

如果是三到四个技术团队在一起堆页面, 一定是很痛苦的

技术轮子 和 业务的差别, 技术轮子大概还能看懂写的是什么, 但业务逻辑不同, 通常完全就看不懂是做什么的

他们是有要分开的需求, 不要一起写

把不同团队组织到一块, 或者把一个业务拆到不同团队去

技术架构到最后一定是组织架构 组织架构 其实就决定了业务架构

当然把业务拆开也不一定要用到微前端

---

国外对微前端不怎么感冒, 好像只有模块邦联有点讨论 但也激不起水花 大部分的前端更关心于 ssr 缩小页面体积, react server components 等等, 根据其他的原则在区分业务

首先在视觉风格上高概率都不是统一的, 用的组件多半也不是统一的, 交互也多半不是统一的
国内对缝合怪的容忍度其实更高一些

---

微前端框架 本质上就是要解决 应用隔离
因此要解决 JS 隔离 样式隔离 路由同步这样

---

qiankun

JS 沙箱 样式隔离 这两个最常问
解析 html 路由同步 应用通信 很少问

单例模式 多实例模式

但沙箱是可能突破的

1. TC39
   shadowrealms 建立一个真正完全封闭的 不可突破的沙箱
   这个 API 中国希望落地是有强烈的意愿的
   今年是应该会落地的, 不只是对浏览器环境 在 node 环境也可以用,
2. 把 iframe 捡起来
   无界 只丢 js 进 iframe 去
   从 iframe 代理到主页面上
   方法
   做一个新的 document 对象, 把代码丢进一个闭包里去跑
   或者做劫持

   现在新做的微前端框架基本都是这个思路

乾坤的样式隔离是比较费劲的
子应用自己用 css module 或者 vue 的 scoped 方式去隔离 自己去解决

webcomponents 方式隔离更好一些
字体不能放在 shadowdom 里加载的 字体会直接失败不出来 标准就是这样的
字体要挂载在外面
字体怎么处理呢? 挂载主应用上

通信是发布订阅方式

JS 沙箱是最复杂的, 修修补补
很多技术点组合在一起 能跑起来 还是很考验框架作者能力的

---

模块联邦在国内几乎没声音
三年前在国内还是有一定声音, 后来都换成自己的模块方案了

现在的用途 基本就是 优化打包 umi 但也用的不多 这个东西现在真的是没啥用了
稍微去搜两个应用基本是搜不到

emp 2.0 也从模块联邦切走了

---

webcomponent 很好的样式隔离的方案

---

流行框架

qiankun 做事时候 要求接入方自己去处理样式隔离

garfish 字节内部的应用很多 和 qiankun 区别不大 api 都差不多 说是高仿也没问题

现在这两个也基本不怎么迭代了, 其实也没有什么可迭代的东西

wujie 做了很多事情
强制使用 webcomponents
面试时候讲一些使用中遇到的问题
js 隔离走的是 iframe 沙箱隔离

面试时候 横向聊一下框架 知识的广度, 再点评一下 知识的深度
展开来讲 是比较好的

---

业务落地

自己的角色 决策 + 执行

为什么使用微前端 解决了什么问题

(我的话, 不是为了用微前端而用微前端)

微前端其实是工程化能力的一部分体现: 开发工作流 运维部署

---

案例架构

先做一层代理 对各种乾坤或无界的 api 做一层代理 兼容

路由注册 全局状态 全局通知 应用共享(共享库 放在平台/基座上)

有的团队的应用共享 都是服务端下发的 下发一个 unpkg/xxx
大部分的配置都是配置化的

Node 端 路由下发 共享库下发 接口代理 页面权限 bff

子应用入驻平台 - Node 端 - 基座

子应用入驻平台:
菜单入驻 接口配置 共享库配置 权限配置 灰度能力

通常还会提供一套开发工具, 让入驻方可以基于基座去开发, 提供一些 webpack 插件 或 vite 插件 让它的应用可以在基座中跑 优化它的 DX

1. 提供开发工具
2. 提供平台接口能力
3. 提供自入驻能力

乾坤 无界 它本身不是方案
也不要局限于去聊接口, 就当作是 react, 不要聊 react

频繁地改-配置化 频繁地加-服务化

大规模的情况下
用乾坤和无界 其实都是无所谓的 做平台的人其实都是不管的
所以更倾向于乾坤这样的方案 我是做平台的, 微前端好不好用 是你们入驻的人自己的问题 入驻的人想自己的方式去解决问题 比如 css 隔离等等
